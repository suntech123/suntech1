
Step 2.

Select * from EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_DOCUMENT_T where DOC_GLOBAL_DOC_ID = '';



Step 5.

select DOC.documentid , CPT_TEMP.PROC_CD ,CPT_TEMP.COV_DSCN_IND,
       CPT_TEMP.COV_DSCN_RSN, CPT_TEMP.COV_DSCN_REF,
FROM EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_CPTCODE_T CPT_STAGE
INNER JOIN EUIDS_DEV_PIMS_AI_DB.PIMS_AI_DEV.POLDIG_WORKING_CPTCODE_T_TEMP_DELTA_TEST CPT_TEMP
INNER JOIN EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_DOCUMENT_T DOC
ON CPT_TEMP.documentid = DOC.documentid
and CPT_TEMP.documentid = CPT_STAGE.documentid
and CPT_TEMP.PROC_CD = CPT_STAGE.PROC_CD
and (CPT_TEMP.COV_DSCN_IND <> CPT_STAGE.COV_DSCN_IND or CPT_TEMP.COV_DSCN_REF <> CPT_STAGE.COV_DSCN_REF)
and DOC.DOC_GLOBAL_DOC_ID in (
'3e208829-ba5f-445a-a13f-944504b645ea',
'30fc4c98-a824-4523-a742-82ce6b537b34'
) and (CPT_TEMP.COV_DSCN_IND is not null or CPT_TEMP.COV_DSCN_IND <> '')


Step 6.

MERGE INTO EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_CPTCODE_T DEST
USING (
    select DOC.documentid , CPT_TEMP.PROC_CD ,CPT_TEMP.COV_DSCN_IND,
           CPT_TEMP.COV_DSCN_RSN, CPT_TEMP.COV_DSCN_REF,
    FROM EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_CPTCODE_T CPT_STAGE
    INNER JOIN EUIDS_DEV_PIMS_AI_DB.PIMS_AI_DEV.POLDIG_WORKING_CPTCODE_T_TEMP_DELTA_TEST CPT_TEMP
    INNER JOIN EUIDS_DEV_PIMS_DB.PIMS_DEV.POLDIG_DOCUMENT_T DOC
    ON CPT_TEMP.documentid = DOC.documentid
    and CPT_TEMP.documentid = CPT_STAGE.documentid
    and CPT_TEMP.PROC_CD = CPT_STAGE.PROC_CD
    and (CPT_TEMP.COV_DSCN_IND <> CPT_STAGE.cov_dscn_ind or CPT_TEMP.COV_DSCN_REF <> CPT_STAGE.COV_DSCN_REF)
    and DOC.DOC_GLOBAL_DOC_ID in (
        '3e208829-ba5f-445a-a13f-944504b645ea',
        '30fc4c98-a824-4523-a742-82ce6b537b34'
    ) and (CPT_TEMP.COV_DSCN_IND is not null or CPT_TEMP.COV_DSCN_IND <> '')
) AS UPD
ON UPD.documentid=DEST.documentid
and UPD.PROC_CD=DEST.PROC_CD
WHEN MATCHED THEN
UPDATE SET
    DEST.COV_DSCN_IND=UPD.COV_DSCN_IND,
    DEST.COV_DSCN_RSN=UPD.COV_DSCN_RSN,
    DEST.COV_DSCN_REF = UPD.COV_DSCN_REF ;

